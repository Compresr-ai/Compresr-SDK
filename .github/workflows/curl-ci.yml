name: curl SDK

on:
  push:
  pull_request:

jobs:
  style:
    name: Shell Script Linting
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: curl
    steps:
      - uses: actions/checkout@v4
      
      - name: Install shellcheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck
      
      - name: Run shellcheck on all shell scripts
        run: |
          find . -name "*.sh" -type f -exec shellcheck --exclude=SC1091 {} +

  test:
    name: Test curl SDK
    runs-on: ubuntu-latest
    needs: style
    defaults:
      run:
        working-directory: curl
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup test environment
        run: |
          echo "COMPRESR_API_KEY=${{ secrets.COMPRESR_API_KEY }}" > ../.env
          echo "COMPRESR_BASE_URL=https://api.compresr.ai" >> ../.env
      
      - name: Make test scripts executable
        run: chmod +x tests/*.sh
      
      - name: Run tests
        env:
          COMPRESR_API_KEY: ${{ secrets.COMPRESR_API_KEY }}
          COMPRESR_BASE_URL: https://api.compresr.ai
        run: bash tests/run_tests.sh
      
      - name: Cleanup secrets
        if: always()
        run: rm -f ../.env
